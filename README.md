# Dissecting Bitcoin Core

Proposal: Review and update of the book "Dissection of Bitcoin"


* [Architecture](1_0_Bitcoin_Architecture.asciidoc)
  * [Executables](1_0_Bitcoin_Architecture.asciidoc#executables)
  * [Protocol - P2P](1_0_Bitcoin_Architecture.asciidoc#protocol_p2p)
  * [Concurrency Model](1_0_Bitcoin_Architecture.asciidoc#concurrency_model)
    * [TraceThread](1_0_Bitcoin_Architecture.asciidoc#trace_tread)
    * [Script Verification](1_0_Bitcoin_Architecture.asciidoc#script-verification)
    * [Loading Blocks](1_0_Bitcoin_Architecture.asciidoc#loading-blocks)
    * [Servicing RPC Calls](1_0_Bitcoin_Architecture.asciidoc#servicing-rpc-calls)
    * [Load Peer Addresses From DNS Seeds](1_0_Bitcoin_Architecture.asciidoc#load-peer-adresses-from-dns-seeds)
    * [Send And Receive Messages To And From Peers](1_0_Bitcoin_Architecture.asciidoc#send-and-receive-messages-to-and-from-peers)
    * [Initializing Network Connections](1_0_Bitcoin_Architecture.asciidoc#initializing-network-connections)
    * [Opening Added Network Connections](1_0_Bitcoin_Architecture.asciidoc#opening-added-network-connections)
    * [Process Messages from `net` -> `net_processing`](1_0_Bitcoin_Architecture.asciidoc#process-messages-from-net-net-processing)
  * [Notifications Mechanism (`ValidationInterface`)](1_0_Bitcoin_Architecture.asciidoc#notification-mechanism)
  * [Regions](1_0_Bitcoin_Architecture.asciidoc#regions)
    * [`net.{h,cpp}`](1_0_Bitcoin_Architecture.asciidoc#nethcpp)
    * [`net_processing.{h,cpp}`](1_0_Bitcoin_Architecture.asciidoc#net_processinghcpp)
    * [`validation.{h,cpp}`](1_0_Bitcoin_Architecture.asciidoc#validationhcpp)
    * [`txmempool.{h,cpp}`](1_0_Bitcoin_Architecture.asciidoc#txmempoolhcpp)
    * [`coins.{h,cpp} & txdb.{h,cpp}`](1_0_Bitcoin_Architecture.asciidoc#coinshcpptxdbhcpp)
    * [`dbwrapper.{h,cpp} & indexes/`](1_0_Bitcoin_Architecture.asciidoc#dbwrapperhcppandindexes)
    * [`script/`](1_0_Bitcoin_Architecture.asciidoc#script_region)
    * [`consensus/`](1_0_Bitcoin_Architecture.asciidoc#consensus_region)
    * [`policy/`](1_0_Bitcoin_Architecture.asciidoc#policy_region)
    * [`interface/`](1_0_Bitcoin_Architecture.asciidoc#interface_region)
    * [`qt/`](1_0_Bitcoin_Architecture.asciidoc#qt_region)
    * [`rpc/`](1_0_Bitcoin_Architecture.asciidoc#rpc_region)
    * [`wallet/`](1_0_Bitcoin_Architecture.asciidoc#wallet_region)
    * [`miner.{h,cpp}`](1_0_Bitcoin_Architecture.asciidoc#miner_region)
  * [Summary](1_0_Bitcoin_Architecture.asciidoc#summary)
  * [References](1_0_Bitcoin_Architecture.asciidoc#references)
* [ADDR Relay](2_0_ADDR_relay.asciidoc)
  * [Connection Types](2_0_ADDR_relay.asciidoc#connection-types)
  * [Peer seeding sources](2_0_ADDR_relay.asciidoc#peer_seeding_sources)
    * [1. Loaded from `peers.dat`](2_0_ADDR_relay.asciidoc#loaded_from_peers_dat)
    * [2. DNS Seeds](2_0_ADDR_relay.asciidoc#dns_seeds)
    * [3. Fixed seeds](2_0_ADDR_relay.asciidoc#fixed_seeds)
    * [4. `ADDR_FETCH` via `-seednode`](2_0_ADDR_relay.asciidoc#addr_fetch)
    * [5. Manual connection in `-connect` mode](2_0_ADDR_relay.asciidoc#connect_mode)
    * [6. Manual connection with `-addnode`](2_0_ADDR_relay.asciidoc#addnode_manual)
  * [Initial Connection](2_0_ADDR_relay.asciidoc#initial_connection)
  * [`ADDR` or `ADDRV2`](2_0_ADDR_relay.asciidoc#addr_or_addrv2)
  * [`RelayAddress()`](2_0_ADDR_relay.asciidoc#relay_address)
  * [`MaybeSendAddr()`](2_0_ADDR_relay.asciidoc#maybe_send_addr)
  * [`GETADDR`](2_0_ADDR_relay.asciidoc#getaddr)
  * [Summary](2_0_ADDR_relay.asciidoc#summary)
* [Address Manager (AddrMan)](2_1_AddrMan.asciidoc)
  * [Original Implementation](2_1_AddrMan.asciidoc#original_implementation)
  * [Eclipse Attack](2_1_AddrMan.asciidoc#eclipse_attack)
    * [Deployed Countermeasures for Eclipse Attacks](2_1_AddrMan.asciidoc#deployed_eclipse)
      * [Countermeasure 4: Feeler Connections](2_1_AddrMan.asciidoc#eclipse_c4)
      * [Countermeasure 3: test-before-evict](2_1_AddrMan.asciidoc#eclipse_c3)
      * [Countermeasure 1: Deterministic random eviction](2_1_AddrMan.asciidoc#eclipse_c1)
      * [Countermeasure 2: Random selection](2_1_AddrMan.asciidoc#eclipse_c2)
      * [Countermeasure 6: More buckets](2_1_AddrMan.asciidoc#eclipse_c6)
      * [Countermeasure 5: Anchor connections](2_1_AddrMan.asciidoc#eclipse_c5)
    * [Undeployed (or partially deployed) recommended countermeasures](2_1_AddrMan.asciidoc#undeployed_eclipse)
      * [Countermeasure 7: More outgoing connections](2_1_AddrMan.asciidoc#eclipse_c7)
      * [Countermeasure 8: Ban unsolicited ADDR messages](2_1_AddrMan.asciidoc#eclipse_c8)
      * [Countermeasure 9: Diversify incoming connections](2_1_AddrMan.asciidoc#eclipse_c9)
      * [Countermeasure 10: Anomaly detection](2_1_AddrMan.asciidoc#eclipse_c10)
  * [Erebus Attack](2_1_AddrMan.asciidoc#erebus_attack)
    * [Deployed Countermeasures for Erebus Attack](2_1_AddrMan.asciidoc#deployed_erebus)
      * [Countermeasure 2: More outgoing connections](2_1_AddrMan.asciidoc#erebus_c2)
      * [Countermeasure 3:  Selecting peers with AS topology information](2_1_AddrMan.asciidoc#erebus_c3)
    * [Undeployed countermeasures](2_1_AddrMan.asciidoc#undeployed_erebus)
      * [Countermeasure 1: Table size reduction](2_1_AddrMan.asciidoc#erebus_c1)
      * [Countermeasure 4: Smarter eviction policy](2_1_AddrMan.asciidoc#erebus_c4)
* [Evicting An Incoming Connection](2_2_evicting_incoming_connection.asciidoc)
  * [Eviction Mechanism](2_2_evicting_incoming_connection.asciidoc#eviction_mechanism)
  * [Summary](2_2_evicting_incoming_connection.asciidoc#summary)
  * [References](2_2_evicting_incoming_connection.asciidoc#references)
* [Adresses](2_1_bitcoin_address.asciidoc)
* [Transactions](2_2_transactions.asciidoc)
* [Serialization](3_0_serialization.asciidoc)
  * [Original Implementation](3_0_serialization.asciidoc#original-implementation)
  * [Relevant Changes](3_0_serialization.asciidoc#relevant-changes)
    * [PR #352 - secure_allocator and zero_after_free_allocator](3_0_serialization.asciidoc#pr-352---secure_allocator-and-zero_after_free_allocator)
    * [PR #1567 - CHashWriter](3_0_serialization.asciidoc#pr-1567---chashwriter)
    * [PR #2409 - CSerializeData](3_0_serialization.asciidoc#pr-2409---cserializedata)
    * [PR #4508 - CSizeComputer](3_0_serialization.asciidoc#pr-4508---csizecomputer)
    * [PR #5510 - Big endian support](3_0_serialization.asciidoc#pr-5510---big-endian-support)
    * [PR #6914 - prevector](3_0_serialization.asciidoc#pr-6914---prevector)
  * [Transactions Serialization - Current Implementation (BIP 144)](3_0_serialization.asciidoc#transactions-serialization---current-implementation)
    * [VarInt](3_0_serialization.asciidoc#varint)
    * [SerializeTransaction()](https://github.com/leonardojobim/Dissection-Bitcoin-Test/blob/main/3_0_serialization.asciidoc#serializetransaction)
    * [UnserializeTransaction()](3_0_serialization.asciidoc#unserializetransaction)
    * [Serializing a transaction - Process](3_0_serialization.asciidoc#serializing-a-transaction---process)
      * [Sending Requested Transaction](3_0_serialization.asciidoc#sending-requested-transaction)
* [Functional Test Framework](4_0_functional_test_framework.asciidoc)
  * [`test/test_framework/*`](4_0_functional_test_framework.asciidoc#test_test_framework)
  * [BitcoinTestFramework](4_0_functional_test_framework.asciidoc#bitcointestframework_section)
  * [TestNode](4_0_functional_test_framework.asciidoc#testnode_section)
  * [P2PInterface](4_0_functional_test_framework.asciidoc#p2pinterface_section)
  * [Test 1 - Sending Money](4_0_functional_test_framework.asciidoc#test_1_sending_money)
  * [Test 2 - Expected Mempool Behavior](4_0_functional_test_framework.asciidoc#test_2_expected_mempool_behavior)
  * [Test 3 - Adding `P2PInterface` Connections](4_0_functional_test_framework.asciidoc#test_3_adding_p2pinterface_connections)
  * [Summary](4_0_functional_test_framework.asciidoc#summary)
  * [References](4_0_functional_test_framework.asciidoc#references)